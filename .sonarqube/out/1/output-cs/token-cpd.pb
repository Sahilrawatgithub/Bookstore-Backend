¼-
@D:\BridgeLabz\BookStore\ConsumerLayer\RabbitMqConsumerService.cs
	namespace 	
ConsumerLayer
 
{ 
public 

class #
RabbitMqConsumerService (
:) *
BackgroundService+ <
{ 
private 
IConnection 
_connection '
;' (
private 
IModel 
_channel 
;  
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public #
RabbitMqConsumerService &
(& '
IConfiguration' 5
configuration6 C
)C D
{ 	
_configuration 
= 
configuration *
;* +
var 
factory 
= 
new 
ConnectionFactory /
(/ 0
)0 1
{ 
HostName 
= 
$str &
,& '"
DispatchConsumersAsync &
=' (
false) .
} 
; 
_connection 
= 
factory !
.! "
CreateConnection" 2
(2 3
)3 4
;4 5
_channel 
= 
_connection "
." #
CreateModel# .
(. /
)/ 0
;0 1
_channel 
. 
QueueDeclare !
(! "
queue" '
:' (
$str) 1
,1 2
durable  ! (
:  ( )
false  * /
,  / 0
	exclusive!!! *
:!!* +
false!!, 1
,!!1 2

autoDelete""! +
:""+ ,
false""- 2
,""2 3
	arguments##! *
:##* +
null##, 0
)##0 1
;##1 2
}$$ 	
	protected&& 
override&& 
Task&& 
ExecuteAsync&&  ,
(&&, -
CancellationToken&&- >
stoppingToken&&? L
)&&L M
{'' 	
var(( 
consumer(( 
=(( 
new(( !
EventingBasicConsumer(( 4
(((4 5
_channel((5 =
)((= >
;((> ?
consumer** 
.** 
Received** 
+=**  
(**! "
sender**" (
,**( )
args*** .
)**. /
=>**0 2
{++ 
try,, 
{-- 
var.. 
body.. 
=.. 
args.. #
...# $
Body..$ (
...( )
ToArray..) 0
(..0 1
)..1 2
;..2 3
var// 
message// 
=//  !
Encoding//" *
.//* +
UTF8//+ /
./// 0
	GetString//0 9
(//9 :
body//: >
)//> ?
;//? @
var00 
emailMessage00 $
=00% &
JsonConvert00' 2
.002 3
DeserializeObject003 D
<00D E
EmailMessageDTO00E T
>00T U
(00U V
message00V ]
)00] ^
;00^ _
Console22 
.22 
	WriteLine22 %
(22% &
$"22& (
$str22( ?
{22? @
message22@ G
}22G H
"22H I
)22I J
;22J K
GmailTokenSender33 $
GmailSender33% 0
=331 2
new333 6
GmailTokenSender337 G
(33G H
_configuration33H V
)33V W
;33W X
GmailSender44 
.44  
	SendEmail44  )
(44) *
emailMessage44* 6
.446 7
Email447 <
,44< =
emailMessage44> J
.44J K
Subject44K R
,44R S
emailMessage44T `
.44` a
Body44a e
)44e f
;44f g
Console66 
.66 
	WriteLine66 %
(66% &
$"66& (
$str66( <
{66< =
emailMessage66= I
.66I J
Email66J O
}66O P
"66P Q
)66Q R
;66R S
}77 
catch88 
(88 
	Exception88  
ex88! #
)88# $
{99 
Console:: 
.:: 
	WriteLine:: %
(::% &
$"::& (
$str::( B
{::B C
ex::C E
.::E F
Message::F M
}::M N
"::N O
)::O P
;::P Q
};; 
}<< 
;<< 
_channel>> 
.>> 
QueueDeclare>> !
(>>! "
queue?? 
:?? 
$str?? +
,??+ ,
durable@@ 
:@@  
true@@! %
,@@% &
	exclusiveAA !
:AA! "
falseAA# (
,AA( )

autoDeleteBB "
:BB" #
falseBB$ )
,BB) *
	argumentsCC !
:CC! "
nullCC# '
)DD 
;DD 
_channelEE 
.EE 
BasicConsumeEE !
(EE! "
queueEE" '
:EE' (
$strEE) 5
,EE5 6
autoAckEE7 >
:EE> ?
trueEE@ D
,EED E
consumerEEF N
:EEN O
consumerEEP X
)EEX Y
;EEY Z
returnHH 
TaskHH 
.HH 
CompletedTaskHH %
;HH% &
}II 	
publicKK 
overrideKK 
voidKK 
DisposeKK $
(KK$ %
)KK% &
{LL 	
_channelMM 
?MM 
.MM 
CloseMM 
(MM 
)MM 
;MM 
_connectionNN 
?NN 
.NN 
CloseNN 
(NN 
)NN  
;NN  !
baseOO 
.OO 
DisposeOO 
(OO 
)OO 
;OO 
}PP 	
}QQ 
}RR 
;RR Ï
@D:\BridgeLabz\BookStore\ConsumerLayer\Helper\GmailTokenSender.cs
	namespace

 	
ConsumerLayer


 
.

 
Helper

 
{ 
internal 
class 
GmailTokenSender #
{ 
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
GmailTokenSender 
(  
IConfiguration  .
configuration/ <
)< =
{ 	
_configuration 
= 
configuration *
;* +
} 	
public 
void 
	SendEmail 
( 
string $
to% '
,' (
string) /
subject0 7
,7 8
string9 ?
body@ D
)D E
{ 	
try 
{ 
var 
smtpUsername  
=! "
_configuration# 1
[1 2
$str2 J
]J K
;K L
var 
smtpPassword  
=! "
_configuration# 1
[1 2
$str2 J
]J K
;K L
var 

smtpServer 
=  
_configuration! /
[/ 0
$str0 J
]J K
;K L
var 
smtpPort 
= 
int "
." #
Parse# (
(( )
_configuration) 7
[7 8
$str8 L
]L M
)M N
;N O
var 

smtpClient 
=  
new! $

SmtpClient% /
(/ 0

smtpServer0 :
): ;
{ 
Port 
= 
smtpPort #
,# $
Credentials 
=  !
new" %
NetworkCredential& 7
(7 8
smtpUsername8 D
,D E
smtpPasswordF R
)R S
,S T
	EnableSsl   
=   
true    $
,  $ %
Timeout!! 
=!! 
$num!! #
}"" 
;"" 
var$$ 
mailMessage$$ 
=$$  !
new$$" %
MailMessage$$& 1
{%% 
From&& 
=&& 
new&& 
MailAddress&& *
(&&* +
$str&&+ F
)&&F G
,&&G H
Subject'' 
='' 
subject'' %
,''% &
Body(( 
=(( 
body(( 
,((  

IsBodyHtml)) 
=))  
true))! %
,))% &
}** 
;** 
mailMessage,, 
.,, 
To,, 
.,, 
Add,, "
(,," #
to,,# %
),,% &
;,,& '

smtpClient.. 
... 
Send.. 
(..  
mailMessage..  +
)..+ ,
;.., -
Console// 
.// 
	WriteLine// !
(//! "
$"//" $
$str//$ @
{//@ A
to//A C
}//C D
"//D E
)//E F
;//F G
}00 
catch11 
(11 
	Exception11 
ex11 
)11  
{22 
Console33 
.33 
	WriteLine33 !
(33! "
$"33" $
$str33$ 9
{339 :
ex33: <
.33< =
Message33= D
}33D E
"33E F
)33F G
;33G H
}44 
}55 	
}66 
}77 Ö
<D:\BridgeLabz\BookStore\ConsumerLayer\DTO\EmailMessageDTO.cs
	namespace 	
ConsumerLayer
 
. 
DTO 
{ 
public		 

class		 
EmailMessageDTO		  
{

 
public 
string 
Subject 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Body 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
} 
} 